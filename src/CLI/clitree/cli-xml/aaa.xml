<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE CLISH_MODULE [
]>
<!--
Copyright 2019 Dell, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<CLISH_MODULE
    xmlns="http://www.dellemc.com/sonic/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xsi:schemaLocation="http://www.dellemc.com/sonic/XMLSchema
                        http://www.dellemc.com/sonic/XMLSchema/clish.xsd"
    >
<!--=========================================================================-->
  <PTYPE
     name="AAA_AUTH_TACPLUS"
     method="select"
     pattern="tacacs+(tacacs+)"
     help=""
     />
<!--=========================================================================-->
  <PTYPE
     name="AAA_AUTH_RADIUS"
     method="select"
     pattern="radius(radius)"
     help=""
     />
  <!--=========================================================================-->
  <PTYPE
     name="AAA_AUTH_LOCAL"
     method="select"
     pattern="local(local)"
     help=""
     />
  <!--=========================================================================-->

  <VIEW name="enable-view">
    <COMMAND name="show aaa"
             help="Show aaa info">
      <ACTION>python $SONIC_CLI_ROOT/sonic-cli-aaa.py get_openconfig_system_system_aaa_authentication_config show_aaa.j2</ACTION>
      <DOCGEN>
          <DESCRIPTION>
              Displays global configuration for aaa authentication. Login method and failthrough setting is displayed.
          </DESCRIPTION>
          <USAGE>
             Use the show command to display aaa authentication global parameters.
          </USAGE>
          <EXAMPLE summary="Display aaa authentication parameters">
sonic(config)# do show aaa
---------------------------------------------------------
AAA Authentication Information
---------------------------------------------------------
failthrough  : False
login-method : local
          </EXAMPLE>
      </DOCGEN>
    </COMMAND>
  </VIEW>

  <VIEW name="configure-view">
    <!-- aaa -->
    <COMMAND name="aaa"
             help="AAA configuration"/>

    <!-- config sub view for aaa authentication -->
    <COMMAND name="aaa authentication"
             help="AAA authentication configuration"/>

    <COMMAND name="aaa authentication failthrough"
             help="AAA authentication failthrough status"
             mode="subcommand"
             ptype="SUBCOMMAND">
      <PARAM name="enable"
             help="failthrough status"
             ptype="ENA_DISA">
      </PARAM>
      <ACTION> if test "${enable}" = "enable" ; then&#xA;
        python $SONIC_CLI_ROOT/sonic-cli-aaa.py put_openconfig_system_ext_system_aaa_authentication_config_failthrough True&#xA;
          else&#xA;
        python $SONIC_CLI_ROOT/sonic-cli-aaa.py put_openconfig_system_ext_system_aaa_authentication_config_failthrough False&#xA;
          fi&#xA;
      </ACTION>
      <DOCGEN>
          <DESCRIPTION>
              Configure failthrough mechanism for aaa authentication.
          </DESCRIPTION>
          <USAGE>
             Use the command to enable or disable failthrough mechanism for pam modules.
          </USAGE>
          <EXAMPLE summary="Enable/disable aaa authentication failtrhough mechanism for pam modules">
sonic(config)# aaa authentication failthrough
enable  disable
sonic(config)# aaa authentication failthrough disable
sonic(config)# do show aaa
---------------------------------------------------------
AAA Authentication Information
---------------------------------------------------------
failthrough  : False
login-method : local
sonic(config)# aaa authentication failthrough enable
sonic(config)# do show aaa
---------------------------------------------------------
AAA Authentication Information
---------------------------------------------------------
failthrough  : True
login-method : local
          </EXAMPLE>
      </DOCGEN>
    </COMMAND>

    <COMMAND name="aaa authentication login-method"
             help="AAA authentication login method preference"
             mode="subcommand"
             ptype="SUBCOMMAND">
      <PARAM name="login" 
             help="login methods" 
             mode="switch" 
             ptype="SUBCOMMAND">
          <PARAM name="local" 
                 help="local authentication" 
                 optional="true" 
                 mode="subcommand" 
                 ptype="SUBCOMMAND">
              <PARAM name="tacacs+" 
                     test='"${radius}"!="radius"' 
                     help="tacacs+ authentication" 
                     optional="true" 
                     ptype="AAA_AUTH_TACPLUS"> 
              </PARAM>
              <PARAM name="radius" 
                     test='"${tacacs+}"!="tacacs+"' 
                     help="radius authentication" 
                     optional="true" 
                     ptype="AAA_AUTH_RADIUS"> 
              </PARAM>
          </PARAM>
          <PARAM name="tacacs+" 
                 help="tacacs+ authentication" 
                 optional="true" 
                 mode="subcommand" 
                 ptype="SUBCOMMAND">
              <PARAM name="local" 
                     help="local authentication" 
                     optional="true" 
                     ptype="AAA_AUTH_LOCAL"> 
              </PARAM>
          </PARAM>
          <PARAM name="radius" 
                 help="radius authentication" 
                 optional="true" 
                 mode="subcommand" 
                 ptype="SUBCOMMAND"> 
              <PARAM name="local" 
                     help="local authentication" 
                     optional="true" 
                     ptype="AAA_AUTH_LOCAL"> 
              </PARAM>
          </PARAM>
      </PARAM>
      <ACTION> python $SONIC_CLI_ROOT/sonic-cli-aaa.py put_openconfig_system_system_aaa_authentication_config_authentication_method ${login} ${local} ${tacacs+} ${radius} </ACTION>
      <DOCGEN>
          <DESCRIPTION>
             Configure list of authentication methods to define the types of authentication and the sequence in which they apply.
             By default, local authentication method is used.
          </DESCRIPTION>
          <USAGE>
             The authentication methods in the method list execute in the order you configure them. Reenter the methods to change the order.
             The local authentication method remains enabled even if you remove all configured methods.
          </USAGE>
          <EXAMPLE summary="Configure login method(s) for aaa authentication">
sonic(config)# aaa authentication login-method tacacs+
sonic(config)# do show aaa
---------------------------------------------------------
AAA Authentication Information
---------------------------------------------------------
failthrough  : False
login-method : tacacs+
sonic(config)# aaa authentication login-method tacacs+ local
sonic(config)# do show aaa
---------------------------------------------------------
AAA Authentication Information
---------------------------------------------------------
failthrough  : False
login-method : tacacs+, local
sonic(config)# aaa authentication
failthrough  login-method
sonic(config)# aaa authentication login-method radius local
sonic(config)# do show aaa
---------------------------------------------------------
AAA Authentication Information
---------------------------------------------------------
failthrough  : False
login-method : radius, local
sonic(config)# aaa authentication login-method local radius
sonic(config)# do show aaa
---------------------------------------------------------
AAA Authentication Information
---------------------------------------------------------
failthrough  : False
login-method : local, radius
sonic(config)# no aaa authentication login-method
sonic(config)# do show aaa
---------------------------------------------------------
AAA Authentication Information
---------------------------------------------------------
failthrough  : False
login-method : local
          </EXAMPLE>
      </DOCGEN>
    </COMMAND>
    <COMMAND name="no aaa" help="Unconfigure aaa authentication configuration"/>
    <COMMAND name="no aaa authentication" help="Unconfigure aaa authentication configuration"/>
    <COMMAND name="no aaa authentication login-method" help="Unconfigure aaa authentication login method">
      <ACTION>python $SONIC_CLI_ROOT/sonic-cli-aaa.py put_openconfig_system_system_aaa_authentication_config_authentication_method local</ACTION>
      <DOCGEN>
          <DESCRIPTION>
             Unconfigure previously configured login methods for aaa authentication.
          </DESCRIPTION>
          <USAGE>
             The local authentication method remains enabled when you remove configured methods.
          </USAGE>
          <EXAMPLE summary="Unconfigure login method(s) for aaa authentication">
sonic(config)# do show aaa
---------------------------------------------------------
AAA Authentication Information
---------------------------------------------------------
failthrough  : False
login-method : local, radius
sonic(config)# no aaa authentication login-method
sonic(config)# do show aaa
---------------------------------------------------------
AAA Authentication Information
---------------------------------------------------------
failthrough  : False
login-method : local
          </EXAMPLE>
      </DOCGEN>

    </COMMAND>
  </VIEW>

</CLISH_MODULE>
